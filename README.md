# KillSeat: 공연 예매 플랫폼

> **현재 배포 중단 상태입니다.**

* **배포 주소**: http://killseat.kro.kr
* **API 문서**: http://killseat.kro.kr:8080/swagger-ui/index.html

---

## 1. 프로젝트 개요

KillSeat은 사용자가 공연 정보를 조회하고 좌석을 선택해 자리를 예매할 수 있는 공연 예매 플랫폼.

---

## 2. 기술 스택

### Development
* **Frontend**: React (Vite)
* **Backend**: Java 21, Spring Boot 3.5.5, Spring Data JPA
* **Database**: MySQL 8.0
* **Cache**: Redis

### Infrastructure & DevOps
* **Server**: AWS EC2 (t3a.small)
* **Container**: Docker
  * frontend: React + Nginx
  * backend: Spring Boot
  * redis: Redis
* **CI/CD**: GitHub Actions
* **Test**: k6

---

## 3. 시스템 아키텍처

![시스템 아키텍처](./images/killseat_structure.png)

---

## 4. 주요 기능

### 인증 및 회원 관리
- JWT 인증: Access Token과 Refresh Token을 이용한 인증을 구현.
- 권한 분리: Spring Security를 통해 일반 사용자와 관리자의 접근 권한 분리.

### 커뮤니티 (게시판)
- 게시물 관리: 공연 후기 및 정보 공유를 위한 CRUD 기반 게시판을 구축함.
- 댓글 시스템: 단층 구조(1-Depth)의 댓글 기능을 통해 사용자 간 기본적인 소통이 가능하도록 구현.
- 데이터 연동: 회원 정보와 연동하여 작성자 검증 및 접근 제어를 수행.

### 공연 및 좌석 관리
- 공연 정보 조회: Redis 캐싱을 통해 공연 목록 조회 시 DB 부하를 최소화함.
- 실시간 좌석 제어: 관리자가 특정 좌석을 직접 선택하여 예약 가능 상태를 제어할 수 있는 기능을 제공.

### 예매 및 결제
- 대기열 시스템: Redis를 활용해 티켓 오픈 시점의 트래픽을 순차적으로 처리함.
- 중복 예매 방지: 비관적 락을 적용하여 동일 좌석에 대한 동시 요청 시 데이터 무결성을 보장.
- 결제 연동: PortOne API를 연동하여 카카오페이 테스트 결제를 프로세스를 구축하고, 서버 측 검증 로직을 구현.

---

## 5. [공연 목록] Redis 기반 공연 목록 조회

공연 목록 조회 시 발생하는 DB 병목을 확인하고, Redis를 통해 성능을 개선함.
* **테스트 대상**: 공연 목록 조회 (더미 데이터 1000건)
* **테스트 환경**: AWS t3a.small

### 5-1. DB 환경의 한계 (VU 200)
DB 기반 공연 목록 조회 시 200명의 가상 사용자만으로도 응답 시간이 급격히 지연되는 병목 현상이 생김.

| 측정 지표 | DB |
| :--- | :--- |
| **Throughput (TPS)** | 114.2/s |
| **p(95) Response Time** | 722.98ms |

### 5-2. Redis 도입 결과 비교 (VU 200)
공연 목록 조회에 Redis를 도입한 결과, 동일 부하 환경에서 더 나은 성능 향상을 기록함.

| 측정 지표 | DB 조회 | Redis 캐시 적용 | 개선 효과 |
| :--- | :--- | :--- | :--- |
| **Throughput (TPS)** | 114.2/s | 149.5/s | **31% 향상** |
| **p(95) Response Time** | 722.98ms | 6.78ms | **99% 단축** |

### 5-3. Redis 한계 지점 테스트 (VU 1200)
시스템의 응답 지연이 급격히 증가하는 구간을 확인하기 위해 찾기 위해 부하를 최대 1200 VU까지 늘림.

| 측정 지표 | Redis 적용 (VU 1200)  |
| :--- | :--- |
| **Throughput (TPS)** | 1,654.7/s |
| **p(95) Response Time** | 381.92ms |
| **Error Rate** | 0.00% |

* **결과**:  VU 1000명 기점부터 p(95) 지연 시간이 381.92ms로 증가하는 성능 변곡점을 발견함.

---

## 6. [대기열] Redis & SSE 기반 대기열
Redis와 SSE를 결합하여, 티켓 오픈 시점에 발생하는 순간적인 트래픽을 제어하기 위한 대기열 시스템을 구축함.

### 6-1. 시스템 아키텍처 및 흐름
1. **대기열 진입**  
   예약 요청은 즉시 처리되지 않고 Redis의 Sorted Set에 진입하며, 선착순 순번을 관리함. <br>
2. **실시간 통신**  
   SSE(Server-Sent Events)를 사용해 서버와의 연결을 유지하며, 사용자는 자신의 대기 순번 변화를 실시간으로 확인함.

### 6-2. 이점
* **트래픽 완화**: 예약 서버로 유입되는 동시 요청 수를 제어해, 폭주 상황에서도 시스템 안정성을 유지함.
* **UX 개선**: 새로고침 없이 실시간으로 대기 순번을 제공하여 사용자 경험을 향상시킴.

---

## 7. [예약] 비관적 락 및 인덱스 최적화

동시성 요청이 집중되는 예약 로직에서 데이터 무결성을 확보하고, 인덱스를 적용시켜 좌석 데이터 조회 효율을 높임.

### 7-1. 비관적 락(Pessimistic Lock) 적용
* **목적**: 동일 좌석에 대한 중복 예매 발생 가능성을 차단.
* **이유**: 트래픽 밀집 상황에서 재시도 비용이 발생하는 낙관적 락보다 서비스 안정성 면에서 유리하다고 판단.
* **결과**: 동시성 테스트를 통해 중복 예매 발생 0건 확인.

### 7-2. 인덱스 활용을 통한 시스템 최적화
* **목적**: 좌석 데이터 조회 효율화.
* **방법**: 인덱스를 구성하여 데이터 접근 단계를 최소화함.
* **이점**: 
    - **좌석 데이터 조회 속도 향상**: 실제 데이터 블록에 접근하는 단계를 생략하고 인덱스 정보만으로 응답하여 응답 속도를 확보함
    - **트래픽 대응력 향상**: DB의 부하를 줄여, 예매 오픈 시점과 같은 대량의 동시 접속 상황에서도 안정적인 서비스 유지 가능함.

---

## 8. [운영] 관리자 메뉴
운영 효율성을 높이기 위한 관리자 메뉴 구축.

* **회원 조회**: 전체 유저 목록 조회.
* **공연 및 회차 관리**: 공연 등록 및 수정, 공연 회차별 스케줄(Date/Time) 관리.
* **좌석 제어**: 관리자 페이지 내 배치도 UI를 통해 특정 좌석을 직접 선택하여 판매 가능/차단 상태를 즉시 토글.
* **예약 및 결제 내역**: 전체 예약 및 결제 내역 조회.
---

## 9. 주요 기능 시연

### 서비스 실행 화면
| 티켓 예매 프로세스 | 커뮤니티 게시판 |
| :---: | :---: |
| ![티켓 예매 프로세스](./images/booking.gif) | ![자유 게시판](./images/board.gif) |
| 비관적 락을 통한 중복 예매 방지 및<br>포트원 연동 결제 처리 | 공연 후기 및 정보 공유를 위한<br>기본 게시판 기능 |

| 공연 등록 및 수정 | 좌석 상태 제어 |
| :---: | :---: |
| ![관리자 공연 등록](./images/performance_create.gif) | ![관리자 좌석 제어](./images/seat_block.gif) |
| 공연 정보 등록 및 <br>공연 정보 수정 | 현장 판매 및 안전 구역 확보를 위한<br>특정 좌석 예약 제어 |

---

## 10. ERD

![ERD](./images/killseat_ERD.png)